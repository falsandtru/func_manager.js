<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QUnit</title>
  <link rel="stylesheet" href="//code.jquery.com/qunit/qunit-1.14.0.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script src="//code.jquery.com/qunit/qunit-1.14.0.js"></script>
  <script src="/lib/func_manager.js"></script>
<script>
( function () {
  var count = 0;
  fm('demo');
  fma.demo = function(){count--};
  fma.demo = function(){return count};
  !fma.demo() && alert("error");
} )();

test( "function manager", function() {
  ok( 1 == "1", "Passed!" );
  
  fm('test');
  
  equal( typeof fm.test, 'object', "fm.test" );
  equal( typeof fma.test, 'function', "fma.test" );
  
  var count=0;
  fma.test = function(){count++};
  fma.test = function(){return count};
  equal( fma.test(), 1, "setter, getter" );
  
  fm.test.clear();
  fm.test.exec();
  equal( fm.test.exec(), undefined, "clear, exec" );
  
  fm('test');
  
  var count=0;
  fm.test.set( function(){count++} );
  fm.test.set( function(){return count} );
  equal( fm.test.get()(), 1, "set, get" );
  
  var count=0;
  fm.test.pop();
  fm.test.shift();
  fm.test.unshift( function(){count++} );
  fm.test.push( function(){return count} );
  equal( fm.test.get()(), 1, "array prop" );
  
  fm('params', { params: [ 1 ] });
  
  var count=0;
  fma.params = function(count){return count};
  equal( fma.params(), 1, "params" );
  
  fm('unique', { unique: true });
  
  var count=0;
  fma.unique = function(){count++};
  fma.unique = function(){count++};
  fma.unique = function(){return count};
  equal( fma.unique(), 1, "unique" );
  
  fm('chain', { chain: true });
  
  var count=0;
  fma.chain = function(){return ++count};
  fma.chain = function(count){return count};
  equal( fma.chain(), 1, "chain" );
  
  fm('ctor', { ctor: function(){
    var count=0;
    this.rate = 2;
  } });
  
  var count=0;
  fma.ctor = function(){++count};
  fma.ctor = function(){return count * this.rate};
  equal( fma.ctor(), 2, "ctor" );
  equal( fma.ctor(), 4, "ctor" );
  
  fm('param', {
    ctor: function(){var count=1;},
    params: [ 1 ],
    chain: true,
    unique: true
  });
  
  var count=0;
  fma.param = function(param){return ++count+param};
  fma.param = function(ret){return ++ret};
  fma.param = function(ret){return ret};
  equal( fma.param(), 4, "ctor, unique, chain, params" );
  
  fm('reset', { ctor: function(){ var count=1; } });
  
  var count=0;
  fma.reset = function(){count++};
  fm('reset', { ctor: function(){ var count=0; } });
  fma.reset = function(){count++};
  fma.reset = function(){return count};
  equal( fma.reset(), 1, "reset" );
  
  equal( fma.param(), 5, "ctor, unique, chain, params" );
});
</script>
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
</body>
</html>